
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>My little Android warehouse</title>
  <meta name="author" content="Federico Paolinelli">

  
  <meta name="description" content=".. since my last blogpost. I&rsquo;ve done a few things in the meanwhile, I wrote a game with LibGdx, I tinkered with various frameworks, but on top &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://fedepaol.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="My little Android warehouse" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16514009-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My little Android warehouse</a></h1>
  
    <h2>Random thoughts about my experience as moonlight android developer.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:fedepaol.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/09/04/its-been-a-while/">It's Been a While</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-09-04T23:13:14+02:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>11:13 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>.. since my last blogpost.</h3>

<p>I&rsquo;ve done a few things in the meanwhile, I wrote a game with LibGdx, I tinkered with various frameworks, but on top of all these things I&rsquo;ve been taking care of my one (and a half) year old daughter.</p>

<p>I do certainly have less time to devote to side projects, but I still like to learn new things and Android is exciting from that point of view.</p>

<p>While trying to catch up with all the new things that keep happening in the Android World, I hope I&rsquo;ll be able to post more often here.</p>

<p>PS: I used this post to reacquatain myself with octopress</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/01/dragging-with-viewdraghelper/">Dragging With ViewDragHelper</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-01T20:48:20+02:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2014</span></span> <span class='time'>8:48 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>While working on my <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=909434">last side gig</a>, a patch to Firefox for Android to allow the urlbar to be dragged in order to show content hidden behind the main view, I had to deal with ViewDragHelper and understand how it works.</p>

<p>The final result (please note that the patch is still under review) is something like this:</p>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/rKRIZB6nQfg" allowfullscreen></iframe></div>


<p>It caused me more than one headache, and for this reason I am writing this post hoping it might be helpful to anybody wanting to tinker with it.</p>

<p>ViewDragHelper&rsquo;s usage is not well documented, but <a href="http://flavienlaurent.com/blog/2013/08/28/each-navigation-drawer-hides-a-viewdraghelper">this post</a> by Flavien Laurent is the best place you could start from.</p>

<p>In order to provide a simpler example for this post, I&rsquo;ll introduce a simplified version of what I have done on Firefox, without all the extra code needed to interact with the rest of the app.</p>

<p>Let&rsquo;s start with..</p>

<h2>How touch events are handled</h2>

<p>A good source of information is the <a href="http://developer.android.com/training/gestures/viewgroup.html">official documentation</a>. However, I&rsquo;ll write a short introduction here.</p>

<p>Whenever a touch event happens, the parent view is being asked if it wants to handle that event in place of its children. This is done by calling its <code>onInterceptTouchEvent()</code> method, which should return true if the parent view wants to handle the event.</p>

<p>In case the event is trapped by the parent, its <code>onTouchEvent()</code> method gets called and it must return true if the event is handled.</p>

<p>Children view can also rebel against their parent tiranny, and disable this mechanism by calling <code>requestDisallowInterceptTouchEvent()</code>. By doing that, they ensure that the touch event wont be passed to the parent view.</p>

<p><img src="/images/touches.png" width="350" height="350" title="touches" alt="images"></p>

<h2>How ViewDragHelper works</h2>

<p>The idea behind it is pretty simple. You register a draghelper on a container view</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">mDragHelper</span> <span class="o">=</span> <span class="n">ViewDragHelper</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="mf">1.0f</span><span class="o">,</span> <span class="k">new</span> <span class="nf">DragHelperCallback</span><span class="o">());</span>
</span></code></pre></td></tr></table></div></figure>


<p>and then you set a couple of entry points, one to listen if a drag is being started (or is in progress), the other to handle the motion events and perform the dragging when the event is being passed to the view it registered against:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onInterceptTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">mDragHelper</span><span class="o">.</span><span class="na">shouldInterceptTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onInterceptTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mDragHelper</span><span class="o">.</span><span class="na">processTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ViewDragHelper will be asked to check if a motion event is part of a dragging process. The behaviour of the whole dragging process is ruled by a <code>DragHelperCallback</code> instance passed on creation.
<code>DragHelperCallback</code> has method that need to be implemented to be notified of particular evens, such as:</p>

<ul>
<li>a change in the dragging state</li>
<li>a change in the dragged view location</li>
<li>when and where the dragged view was released</li>
</ul>


<p>It also has methods used to influence the dragging behaviour:</p>

<ul>
<li>clamp the position of the view / the range it can be dragged within</li>
<li>check whether a particular subview can be dragged</li>
</ul>


<p>A whole drag process is intended a sequence of <code>Down</code> / <code>Move</code> / <code>Up</code> events over a particular target view.
Whenever a drag process starts, ViewDragHelper finds the topmost child that contains the location of the motion event, and asks us if that particular view can be dragged or not in <code>tryToCaptureView()</code> method.<br/>
This is <em>more or less</em> the theory involved in the dragging process. On top of that, ViewDragHelper offers also <code>settleAt</code> methods to let the views settle to their rest location gracefully.</p>

<p>Since explaining in words it&rsquo;s not the easiest thing (nor I am particularly good to explain), I&rsquo;ll introduce the simplified app I used to understand (a bit) how ViewDragHelper works.</p>

<h1>Enters DragQueen</h1>

<p><img src="https://farm6.staticflickr.com/5128/5356147569_686637006e.jpg" width="350" height="350" title="dragqueen" alt="images"> <a href="https://www.flickr.com/photos/kbyte/5356147569/in/photolist-9aiE4T-oZtA-6YfGh-ebJmp8-jCeRGT-7xRKgx-7csUvo-nFTXP8-nFTXNg-9DAWnB-dbWyHz-m2FLMf-6x5QY2-5vkGLh-9jwh4a-KCBSK-dJTFb-4XRtDY-ouiHNw-od7U9J-oiKnUm-6DTq9a-6d1uXV-ocLauF-7VXBD4-n4y95v-ouj2w5-oaD6SK-owCHq3-6xQaS8-je4k6-ng25wJ-oDWV9V-os7FZk-8oeWRF-oRT83M-2PtLZZ-6x5Pkt-49vCUN-49rtdk-S9buU-f5Wr7L-49vCQw-nVMgN7-6wABHo-fX91x-6x5PQH-51DtKg-7mVAco-miQ2Q/">Licensed under commons creative</a></p>

<p>(Just kidding). DragQueen is a (ultra) simplified version of what I implemented on fennec with a button named queen that you can drag.</p>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/Vo4381SSNn0" allowfullscreen></iframe></div>


<p></p>

<p>It consists of:</p>

<ul>
<li>OuterLayout (the root element of our activity, the one that contains the views we want to drag)</li>
<li>a front panel which can be dragged</li>
</ul>


<p><img src="/images/draghelper.png" width="350" height="350" title="draghelper" alt="images"></p>

<p>To make the things a bit more complex we want to enable the dragging only from a particular subview, Queen. To make the things even more complex, we want to be also able to interact with Queen button while the dragging is not happening.</p>

<p>We also allow only two rest locations, so if the view is released mid-way it will settle to its open / close location depending on the speed and the location of when the view is released.
Finally, note that OuterLayout contains also a button that is hidden when main layout is in its closed state.</p>

<h3>OuterLayout</h3>

<p>Outerlayout is a ViewGroup that extends a RelativeLayout.<br/>
As I wrote before, the two methods ViewDragHelper needs to hook into are</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onInterceptTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">isQueenTarget</span><span class="o">(</span><span class="n">event</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">mDragHelper</span><span class="o">.</span><span class="na">shouldInterceptTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onTouchEvent</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">isQueenTarget</span><span class="o">(</span><span class="n">event</span><span class="o">)</span> <span class="o">||</span> <span class="n">isMoving</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">mDragHelper</span><span class="o">.</span><span class="na">processTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>You may notice that <code>onInterceptTouchEvent</code> if has another condition. This is because we want to drag mainlayout only if the touch targets the Queen (it would not be drag-queen otherwise). This is a simplified version of what happens in Fennec, where we want to intercept the drag only if it starts from the toolbar to avoid to interfere with the web content.</p>

<p>In any case, checking if Queen is targeted is quite easy:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isQueenTarget</span><span class="o">(</span><span class="n">MotionEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">int</span><span class="o">[]</span> <span class="n">queenLocation</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="mi">2</span><span class="o">];</span>
</span><span class='line'>    <span class="n">mQueenButton</span><span class="o">.</span><span class="na">getLocationOnScreen</span><span class="o">(</span><span class="n">queenLocation</span><span class="o">);</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">upperLimit</span> <span class="o">=</span> <span class="n">queenLocation</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">+</span> <span class="n">mQueenButton</span><span class="o">.</span><span class="na">getMeasuredHeight</span><span class="o">();</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">lowerLimit</span> <span class="o">=</span> <span class="n">queenLocation</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">event</span><span class="o">.</span><span class="na">getRawY</span><span class="o">();</span>
</span><span class='line'>    <span class="k">return</span> <span class="o">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">lowerLimit</span> <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">upperLimit</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Other methods that influence the behaviour of the dragging are:</h2>

<h4>tryCaptureView</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">tryCaptureView</span><span class="o">(</span><span class="n">View</span> <span class="n">view</span><span class="o">,</span> <span class="kt">int</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="o">(</span><span class="n">view</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">==</span> <span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">main_layout</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>which gives draghelper the permission to drag main layout). You <em>must</em> return true up there for the view you want to be dragged.</p>

<h4>getViewVerticalDragRange &amp;&amp; clampViewPositionVertical (there are <em>Horizontal</em> flavours too)</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getViewVerticalDragRange</span><span class="o">(</span><span class="n">View</span> <span class="n">child</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">mVerticalRange</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">clampViewPositionVertical</span><span class="o">(</span><span class="n">View</span> <span class="n">child</span><span class="o">,</span> <span class="kt">int</span> <span class="n">top</span><span class="o">,</span> <span class="kt">int</span> <span class="n">dy</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">final</span> <span class="kt">int</span> <span class="n">topBound</span> <span class="o">=</span> <span class="n">getPaddingTop</span><span class="o">();</span>
</span><span class='line'>        <span class="kd">final</span> <span class="kt">int</span> <span class="n">bottomBound</span> <span class="o">=</span> <span class="n">mVerticalRange</span><span class="o">;</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">top</span><span class="o">,</span> <span class="n">topBound</span><span class="o">),</span> <span class="n">bottomBound</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>which do what you expect them to do, setting limit for the dragging. In this particular case, vertical range is set to half the size of screen.</p>

<h3>DragQueen</h3>

<p>Note also how <code>mMainLayout</code> is set as clickable with <code>android:clickable="true"</code>. This prevents touch events to be passed down to the view below when it is closed..</p>

<hr />

<h2>Callbacks</h2>

<p>There are several callbacks you will want to implement in order to react to the events related to the dragging:</p>

<h4>onViewDragStateChanged</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onViewDragStateChanged</span><span class="o">(</span><span class="kt">int</span> <span class="n">state</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">mDraggingState</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// no change</span>
</span><span class='line'>            <span class="k">return</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">((</span><span class="n">mDraggingState</span> <span class="o">==</span> <span class="n">ViewDragHelper</span><span class="o">.</span><span class="na">STATE_DRAGGING</span> <span class="o">||</span> <span class="n">mDraggingState</span> <span class="o">==</span> <span class="n">ViewDragHelper</span><span class="o">.</span><span class="na">STATE_SETTLING</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>             <span class="n">state</span> <span class="o">==</span> <span class="n">ViewDragHelper</span><span class="o">.</span><span class="na">STATE_IDLE</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="c1">// the view stopped from moving.</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">mDraggingBorder</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">onStopDraggingToClosed</span><span class="o">();</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">mDraggingBorder</span> <span class="o">==</span> <span class="n">mVerticalRange</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">mIsOpen</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">state</span> <span class="o">==</span> <span class="n">ViewDragHelper</span><span class="o">.</span><span class="na">STATE_DRAGGING</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">onStartDragging</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">mDraggingState</span> <span class="o">=</span> <span class="n">state</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>notifies the state transitions of DragHelper between <code>DRAGGING</code>, <code>IDLE</code> or <code>SETTLING</code> state.</p>

<h4>onViewPositionChanged</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onViewPositionChanged</span><span class="o">(</span><span class="n">View</span> <span class="n">changedView</span><span class="o">,</span> <span class="kt">int</span> <span class="n">left</span><span class="o">,</span> <span class="kt">int</span> <span class="n">top</span><span class="o">,</span> <span class="kt">int</span> <span class="n">dx</span><span class="o">,</span> <span class="kt">int</span> <span class="n">dy</span><span class="o">)</span> <span class="o">{</span>
</span></code></pre></td></tr></table></div></figure>


<p>whose purpouse is pretty clear.</p>

<h4>onViewReleased</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onViewReleased</span><span class="o">(</span><span class="n">View</span> <span class="n">releasedChild</span><span class="o">,</span> <span class="kt">float</span> <span class="n">xvel</span><span class="o">,</span> <span class="kt">float</span> <span class="n">yvel</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">final</span> <span class="kt">float</span> <span class="n">rangeToCheck</span> <span class="o">=</span> <span class="n">mVerticalRange</span><span class="o">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">mDraggingBorder</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">mIsOpen</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>            <span class="k">return</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">mDraggingBorder</span> <span class="o">==</span> <span class="n">rangeToCheck</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">mIsOpen</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>            <span class="k">return</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="kt">boolean</span> <span class="n">settleToOpen</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">yvel</span> <span class="o">&gt;</span> <span class="n">AUTO_OPEN_SPEED_LIMIT</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// speed has priority over position</span>
</span><span class='line'>            <span class="n">settleToOpen</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">yvel</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">AUTO_OPEN_SPEED_LIMIT</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">settleToOpen</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">mDraggingBorder</span> <span class="o">&gt;</span> <span class="n">rangeToCheck</span> <span class="o">/</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">settleToOpen</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">mDraggingBorder</span> <span class="o">&lt;</span> <span class="n">rangeToCheck</span> <span class="o">/</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">settleToOpen</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">final</span> <span class="kt">int</span> <span class="n">settleDestY</span> <span class="o">=</span> <span class="n">settleToOpen</span> <span class="o">?</span> <span class="n">mVerticalRange</span> <span class="o">:</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span><span class="o">(</span><span class="n">mDragHelper</span><span class="o">.</span><span class="na">settleCapturedViewAt</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">settleDestY</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">ViewCompat</span><span class="o">.</span><span class="na">postInvalidateOnAnimation</span><span class="o">(</span><span class="n">OuterLayout</span><span class="o">.</span><span class="na">this</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>is where you (<em>might</em>) want to let the view go into its rest place. I made it behave in such way that dragging speed (and direction) is more important than the place you are releasing the view.</p>

<hr />

<h2>Bonus methods</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">mDragHelper</span><span class="o">.</span><span class="na">settleCapturedViewAt</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">settleDestY</span><span class="o">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>is a helper method that will make your view smoothly settle at the given destination.</p>

<hr />

<h2>Quirks and reasons for headaches</h2>

<h4>ViewDragHelper sets the offset of the target view ..</h4>

<p>  .. by calling <code>offsetTopAndBottom</code>, which is ok <em>but</em> you have to remember that a layout round called by any of the children of outerLayout (or the parent view you are passing to the draghelper) will reset that offset. What you are going to see in that case is your dragged view getting back at its rest position.</p>

<p>A possibile solution to this is to force back the parent where it was before:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">mMainLayout</span><span class="o">.</span><span class="na">addOnLayoutChangeListener</span><span class="o">(</span><span class="k">new</span> <span class="n">View</span><span class="o">.</span><span class="na">OnLayoutChangeListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onLayoutChange</span><span class="o">(</span><span class="n">View</span> <span class="n">v</span><span class="o">,</span> <span class="kt">int</span> <span class="n">left</span><span class="o">,</span> <span class="kt">int</span> <span class="n">top</span><span class="o">,</span> <span class="kt">int</span> <span class="n">right</span><span class="o">,</span> <span class="kt">int</span> <span class="n">bottom</span><span class="o">,</span> <span class="kt">int</span> <span class="n">oldLeft</span><span class="o">,</span> <span class="kt">int</span> <span class="n">oldTop</span><span class="o">,</span> <span class="kt">int</span> <span class="n">oldRight</span><span class="o">,</span> <span class="kt">int</span> <span class="n">oldBottom</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">mOuterLayout</span><span class="o">.</span><span class="na">isMoving</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">v</span><span class="o">.</span><span class="na">setTop</span><span class="o">(</span><span class="n">oldTop</span><span class="o">);</span>
</span><span class='line'>                <span class="n">v</span><span class="o">.</span><span class="na">setBottom</span><span class="o">(</span><span class="n">oldBottom</span><span class="o">);</span>
</span><span class='line'>                <span class="n">v</span><span class="o">.</span><span class="na">setLeft</span><span class="o">(</span><span class="n">oldLeft</span><span class="o">);</span>
</span><span class='line'>                <span class="n">v</span><span class="o">.</span><span class="na">setRight</span><span class="o">(</span><span class="n">oldRight</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">});</span>
</span></code></pre></td></tr></table></div></figure>


<h4>ViewDragHelper always want to intercept the top most child in z order</h4>

<p>If you have some view in between, but you want to be able to drag a lower one, you have to let ViewDragHelper think that your view is the topmost one.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getOrderedChildIndex</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">mainLayoutIndex</span> <span class="o">=</span> <span class="n">indexOfChild</span><span class="o">(</span><span class="n">mMainLayout</span><span class="o">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">index</span> <span class="o">&gt;</span> <span class="n">mainLayoutIndex</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">mainLayoutIndex</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">index</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<h1>What&rsquo;s more</h1>

<p>ViewDragHelper offers a lot more features than those I just presented. <em>DragQueen</em> implements only vertical dragging, but you can drag your views horizontally too. Again, refer to the excellent post by Flavien for more details.</p>

<p>Moreover, ViewDragHelper allows you to intercept drag events that start from the edge of the screen, which is the way its used in the <code>NavigationDrawer</code>.</p>

<p>All it needs to enable it is to call</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">mDragHelper</span><span class="o">.</span><span class="na">setEdgeTrackingEnabled</span><span class="o">(</span><span class="n">ViewDragHelper</span><span class="o">.</span><span class="na">EDGE_LEFT</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>and to implement</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onEdgeDragStarted</span><span class="o">(</span><span class="kt">int</span> <span class="n">edgeFlags</span><span class="o">,</span> <span class="kt">int</span> <span class="n">pointerId</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">mDragHelper</span><span class="o">.</span><span class="na">captureChildView</span><span class="o">(</span><span class="n">mMainLayout</span><span class="o">,</span> <span class="n">pointerId</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h1>TL;DR</h1>

<p>ViewDragHelper is a bit complex and as I said before not well documented. However it allows you to drag views around with very little code, and it can be used to implement nice effects. In any case you can <del>unrestrainedly copy</del> <em>take inspiration</em> from DragQueen source code on <a href="https://github.com/fedepaol/dragqueen">GitHub</a> (it seems to work).
I really hope this post does not contain too many errors and that you enjoyed reading it as much as I did writing.</p>

<p>If you liked this post, consider following me on twitter <a href="https://twitter.com/fedepaol">@fedepaol</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/24/migrating-from-blogger-to-octopress-done/">Migrating From Blogger to Octopress (Done!)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-08-24T19:29:46+02:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>7:29 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It feels a bit like this <img src="http://i.imgur.com/t0XHtgJ.gif" alt="Light bulb" /></p>

<p>but when I had to write a new blogpost and had to embed some code snippets into my blogger hosted blog, I got so pissed of that I chose to migrate my existing blog to a github hosted instance of octopress.</p>

<p>Jason Jarrett made a pretty nice tutorial about the whole process <a href="http://staxmanade.com/2014/04/migrating-blogspot-to-octopress-part-1-introduction/i">here</a>.
However, I had to change a couple of things and I thought those might be helpful to anybody who faces the same problems.</p>

<p>The overall process is something like:</p>

<ul>
<li>setup octopress</li>
<li>import an exported dump of blogger</li>
<li>fix internal links</li>
<li>setup redirects from blogger to your new blog</li>
</ul>


<h2>Setting octopress up</h2>

<p>Nothing to say here. Just go to octopress website and follow the instructions.</p>

<h2>Importing posts from blogger</h2>

<p>This is pretty straightforward too. Export your blogger content as xml, and use <a href="https://gist.github.com/juniorz/1564581">this ruby script</a> that generates a <em>posts</em> folder containing all the posts exported from blogger. Anyway, refer to <a href="http://staxmanade.com/2014/04/migrating-blogspot-to-octopress-part-4-import-content-into-ctopress/">Jason&rsquo;s blog</a>, everything is described accurately there.</p>

<h2>Fix internal links</h2>

<p>You&rsquo;ll have to play a bit with <em>sed</em> in order to fix internal links, otherwise they will keep pointing to blogspot.</p>

<h2>Setup redirects</h2>

<p>Here is where things get interesting, because you will want to make visitors of the old url be redirected to the new blog (possibily with 301). The whole process is a bit tricky due to blogger limitation (for more details check <a href="http://staxmanade.com/2014/04/migrating-blogspot-to-octopress-part-6-301-redirect-old-posts-to-new-location/">here</a>).</p>

<p>There are a couple of other obstacles too: the script available is powershell only. Moreover, Jason suggets to use the alias plugin <a href="https://github.com/imathis/octopress/issues/1610">which seems to be broken at the moment</a>.</p>

<p>However, <a href="https://github.com/jekyll/jekyll-redirect-from">jekyll-redirect</a> seems to work fine, so I chose to use it in my solution.</p>

<p>And finally, since powershell is not an option, here is my python version of the script. It binds the post id with the title of the posts, loop all the html files in your post folder, injects the redirection in the yaml header.</p>

<p>Using it is as easy as calling:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>python blogger_import.py -p octopress/source/_posts/ -b ./blog-08-22-2014.xml
</span></code></pre></td></tr></table></div></figure>


<p>where p is the path of your posts folder, b is the xml file produced by blogspot.</p>

<p>Here is the script:</p>

<div><script src='https://gist.github.com/e46635e3d7de475b0546.js'></script>
<noscript><pre><code>import argparse
import xml.etree.cElementTree as ET
import os


def is_post(node):
    t = node.find(&#39;{http://www.w3.org/2005/Atom}category&#39;).get(&#39;term&#39;)
    d = node.find(&#39;{http://purl.org/atom/app#}control&#39;)
    return (not d) and (t == &#39;http://schemas.google.com/blogger/2008/kind#post&#39;)

def get_posts_id(blogger_dump):
    title_map = {}
    tree = ET.parse(blogger_dump)
    elem = tree.getroot()
    feed = elem.findall(&#39;{http://www.w3.org/2005/Atom}entry&#39;)
    for f in filter(is_post, feed):
        post_id = f.find(&#39;{http://www.w3.org/2005/Atom}id&#39;)
        id_number = post_id.text.split(&#39;-&#39;)[2]
        post_title = f.find(&#39;{http://www.w3.org/2005/Atom}title&#39;).text
        title_map[post_title] = id_number
    return title_map

def inject_redirect(file_name, title_map):
    yaml_separator = 0
    old_file = file_name + &#39;old&#39;
    print file_name
    print old_file
    os.rename(file_name, old_file)
    f = open(old_file, &#39;r&#39;)
    n = open(file_name, &#39;w+&#39;)
    for line in f:
        if line == &#39;---&#39;:
            yaml_separator = yaml_separator + 1
        if yaml_separator == 2:
            n.write(line)
            continue
        if line.startswith(&#39;title&#39;):
            title = line.split(&#39;&quot;&#39;)[1]
            try:
                post_id = title_map[title]
                n.write(&#39;redirect_from:\n&#39;)
                n.write(&#39;  - /blog/%s/\n&#39;%post_id)
            except KeyError:
                print &#39;id not found for &#39; + title
        n.write(line)

def set_redirect(posts_path, titles_map):
    for file_name in os.listdir(posts_path):
        if (file_name.endswith(&#39;html&#39;)):
            inject_redirect(os.path.join(posts_path, file_name), titles_map)

if __name__ == &#39;__main__&#39;:
    parser = argparse.ArgumentParser()
    parser.add_argument(&#39;-p&#39;, &#39;--posts&#39;, dest=&#39;posts_path&#39;, help=&#39;path of the converted _posts&#39;)
    parser.add_argument(&#39;-b&#39;, &#39;--blogger&#39;, dest=&#39;blogger_dump&#39;, help=&#39;blogger dump file&#39;)
    args = parser.parse_args()

    titles_map = get_posts_id(args.blogger_dump)
    set_redirect(args.posts_path, titles_map)
</code></pre></noscript></div>


<h2>TL;DR</h2>

<ul>
<li>Read <a href="http://staxmanade.com/2014/04/migrating-blogspot-to-octopress-part-1-introduction/">Jason&rsquo;s blog</a></li>
<li>When setting up redirection, install <a href="https://github.com/jekyll/jekyll-redirect-from">jekyll-redirect</a></li>
<li>Use my script to inject redirection in the header of exported blogposts</li>
<li>Setup blogger template as described in Jason&rsquo;s blog</li>
</ul>


<p>PS: I still need to write the blogpost that made me switch to octopress.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/08/preloading-localized-data-in-sqllte/">Generating Preloaded Sqlite Data</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-04-08'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>8</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Preloading data in Sqlite is a common problem during android development.<br />The most common solutions are:<br /><ul><li>hardcode the insert statements and execute them (possibly inside a transaction) the first time the db is opened</li><li>place the data inside a csv file, load it the first time the db gets opened, parse the rows and populate the db</li><li>prepare a pre-built sqlite file, ship it along with your app and load it the first time the db is opened</li></ul><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://i.imgur.com/CmGdiFU.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://i.imgur.com/CmGdiFU.jpg" height="320" width="320" /></a></div><br /><ul></ul>I&#8217;ll focus on the third approach, because it allows us to check our db outside the app without extracting it from our device, and because it allows us to prepare the data in a more &#8220;human friendly way&#8221;.<br /><br />It&#8217;s worth to mention the excellent <a href="https://github.com/jgilfelt/android-sqlite-asset-helper">sqlite asset helper</a> library by Jeff Gifelt, that allows us to embed a prebuilt (compressed) sqlite file without having to reinvent the wheel. For this reason, this post will be about how to handle data entry process (and something more), and you won&#8217;t find a (yet another) way to preload a sqlite file.<br /><br />Let&#8217;s start with a problem: you want to build a pretty simple <a href="https://play.google.com/store/apps/details?id=com.whiterabbit.freshfruitveg">Seasonal Fruit and Vegetables</a> app, and the amount of data you have to deal with is big enough to discourage you to prepare the inserts manually.<br />You&#8217;ll have:<br /><ul><li>the list of products</li><li>the description of each product (possibly localized in different languages)</li><li>the data related to the seasonality of each product</li></ul>So, here&#8217;s the approach:<br /><h3>Step 1: data entry </h3>Use a spreadsheet to fill the data in a human friendly way, export it as csv (or tsv, so you won&#8217;t have to deal with any random comma inside the descriptions), parse it and produce the sqlite file together with localized string res files to be embedded inside the application.<br />In my case I had a file&nbsp; having the genre (fruit or veg), the calories count, the name and the description in italian and in english:<br /><br /><pre style="background-image: URL(http://2.bp.blogspot.com/_z5ltvMQPaa8/SjJXr_U2YBI/AAAAAAAAAAM/46OqEP32CJ8/s320/codebg.gif); background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> asparagus     0     25     Asparagi     Descrizione asparagi in italiano.      Asparagus     English asparagus description  <br /> chard          0     12     Bietola          Descrizione bietola in italiano.      Chard          English chard description  <br /></code></pre><br /><br />I also have files that describe the seasonality of each products in different areas, but I will not describe them since they are not relevant to the approach I am describing here.<br /><br /><h3>Step 2: Parse!</h3>Choose your favorite scripting language. I went for python since it&#8217;s super slick and it comes with batteries included, such as xml writing and sqllite support.<br /><br />Creating the db is straightforward:<br /><pre style="background-image: URL(http://2.bp.blogspot.com/_z5ltvMQPaa8/SjJXr_U2YBI/AAAAAAAAAAM/46OqEP32CJ8/s320/codebg.gif); background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;"> CREATE_ITEMS = 'create table Item (_id integer primary key, Name text, kind integer, calories integer);'  <br /> CREATE_ITEM_PER_MONTHS = 'create table ItemPerMonth (ItemId integer, Month integer, Freshness integer, Area integer);'  <br /> CREATE_ITEM_PREFERRED = 'create table PreferredItem (PreferredItemId integer);'  <br /> conn = sqlite3.connect('fruit')  <br /> c = conn.cursor()  <br /> c.execute(CREATE_ITEM_PER_MONTHS)  <br /> c.execute(CREATE_ITEM_PREFERRED)  <br /></code></pre><br /><br />Then we need to use the data we have to fullfill two purpouses:<br /><ul><li>fill the database</li><li>fill the localized string resources&nbsp;</li></ul>Again, filling the database consists of parsing each line of the csv file and calling the appropriate insert.<br /><br />In python is as easy as calling<br /><br /><pre style="background-image: URL(http://2.bp.blogspot.com/_z5ltvMQPaa8/SjJXr_U2YBI/AAAAAAAAAAM/46OqEP32CJ8/s320/codebg.gif); background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;">   cursor.execute(statement)  <br /></code></pre><br />on a cursor object, where statement is the insert statement.<br /><br />Together with that, we do have a lot of data that needs to be rendered in the proper language.<br />In order to take advantage of the resource framework, I chose to generate the resource files instead of relying on a &#8220;locale&#8221; field in the db to filter in my queries.<br />Again, filling an xml node is pretty straightforward in python:<br /><br /><pre style="background-image: URL(http://2.bp.blogspot.com/_z5ltvMQPaa8/SjJXr_U2YBI/AAAAAAAAAAM/46OqEP32CJ8/s320/codebg.gif); background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;">   name = ET.SubElement(root, "string")  <br />   name.set("name", item_name)  <br />   if lang_name.find('%') != -1:  <br />     name.set("formatted", "false")  <br />   name.text = lang_name  <br /></code></pre><br /><br />At this point, we can generate an it_descriptions.xml file and an eng_descriptions.xml file (and even let our script place them in the proper folders).<br /><br />When we want to use our descriptions in Android (i.e. in&nbsp; our cursor adapter&#8217;s bindView), we&nbsp; need to bind the product name (i.e. &#8220;asparagus&#8221;) with the corresponding resource. That&#8217;s easy and it can be done in this way:<br /><br /><pre style="background-image: URL(http://2.bp.blogspot.com/_z5ltvMQPaa8/SjJXr_U2YBI/AAAAAAAAAAM/46OqEP32CJ8/s320/codebg.gif); background: #f0f0f0; border: 1px dashed #CCCCCC; color: black; font-family: arial; font-size: 12px; height: auto; line-height: 20px; overflow: auto; padding: 0px; text-align: left; width: 99%;"><code style="color: black; word-wrap: normal;">  int nameResID = context.getResources().getIdentifier(name,   <br />                     "string", context.getPackageName());  <br /></code></pre><br />By doing that, we can retrieve the resource id of the string related to the name that was generated by our script. If we are worried about the cost of the lookup, we can even add a lru cache to absorb that cost.<br /><br /><br />TL;DR:<br /><ul><li>Write your data in a human readable format</li><li>Parse that data with your favourite language</li><li>Write the data that does not depends on the language in sqllite</li><li>Write the language-dependent data in resource files</li><li>Use getIdentifier for retrieving the resource id of the strings automatically generated</li></ul>Bonus point: again, you can use this convention for pictures as well, so you can throw an &#8220;asparagus.png&#8221; image in your assets to be loaded afterwards.<br /><br />The biggest advantage of this approach is that you have only one master source of your data (the spreadsheet) that you can modify and rerun the generator over every time you modify it. <br /><br />If you are interested in the whole loader python script you can <a href="https://gist.github.com/fedepaol/10193052">check it here</a><br /><br /><br /><br /><br /></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/20/rest-interaction-in-android/">Rest Interaction in Android</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-02-20'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
<div style="text-align: justify;">In last December (&#8216;13) I was asked to submit a talk proposal for the first <a href="http://it.droidcon.com/2014/lineup/">Italian Droidcon</a>, which I did. It got accepted, so in Febraury I gave my first public speech speaking of &#8220;(O)Authenticated Rest Interaction in Android&#8221; in front of real people. <br /><br />This post is meant to be a follow up with the information that can&#8217;t be found in the slides<br /><br /></div><script async="" class="speakerdeck-embed" data-id="ddbb3d50725001312be21e64c86b5257" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script> <br /><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">I hoped to sum all the talk up in a post, but it got too long so I am going to split it in several pieces. This one will cover the asynchronous interaction with a remote webservice.&nbsp; </div><div style="text-align: justify;"><br /><br /></div><div style="text-align: justify;"><span style="font-size: small;">Disclaimer: I am not inventing anything new here, most of the content can be found on the internet. A great source of inspiration is <a href="http://www.youtube.com/watch?v=xHXn3Kg2IQE">this talk</a>, from where I took the inspiration for the approach I am going to explain, probably in a worse way. </span></div><div style="text-align: justify;"><br /><br /></div><h2 style="text-align: justify;"><span style="font-size: x-large;">Rule #1: decouple the interaction with the web service from UI components (activities / fragment)</span></h2><div style="text-align: justify;"><br /></div><div style="text-align: justify;">This means that <b><i>cut and past</i>ing that <i>AsyncTask that contains an HttpUrlConnection</i> code you found on google directly inside your activity is a bad idea</b> (I don&#8217;t even want to remind you that you should NOT host the HttpUrlConnection directly inside your activity, if you are doing that you probably won&#8217;t understand the rest of this post and you should restart your android journey <a href="http://developer.android.com/guide/index.html">here</a>).</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><span style="font-size: large;">There are several reasons for that.&nbsp;</span></div><div style="text-align: justify;">You should start thinking that any network operation has a cost, in terms of bandwith and cpu power. Every time you turn the radio on involves consuming (a lot of) battery power, performing the request and parsing the result involves cpu (and therefore) battery power, <b>so any network operation is precious and you do not want to waste any performed request result</b>.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Said that, you should (must?) be aware that your activity might be killed at any time.. well, not at any time but as soon as it&#8217;s not foregrounded anymore, which is something that is likely to happen if your beloved user chooses to leave your application in favour of candy crush, or if he receives an incoming phone call. </div><div style="text-align: justify;">BUT, the <b>result of a request started inside that activity might still be useful for a latter use</b>, so you do not want your request to be killed together with the activity that hosted it.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Moreover, you should be aware that every time a &#8220;configuration change&#8221; occurs, which is what commonly happens when the device gets rotated, the current activity gets killed and recreated.&nbsp;</div><div style="text-align: justify;">Well, guess what? <b>That ongoing request that costed you a lot of power / cpu is lost, and its result with that</b>. Even worse, it&#8217;s not completely lost, but it might be notified to a leaked activity that nobody will look at anymore because the current one is the one which was recreated. There are ways to circumvent this, like hosting the components that you want to survive to a configuration change inside a <a href="http://www.vogella.com/tutorials/AndroidFragments/article.html#headlessfragments">headless fragment</a>, but again, you should be very careful.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Finally, given that you want to host the interaction with the service inside the activity, and because the activity is guaranteed to be active only as long as it is in foreground, it is obvious that in this way <b>is impossible to schedule requests</b> to be performed while the application is not being used.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Malus point: if you have a <i>god activity</i> that handles the UI interaction, a component like a AsyncTask or a Thread that is in charge of performing the request, the real interaction with the service AND the interaction with the activity in order to update the UI, well, you are likely to have a poor encapsulation of your code and you might have some issues while testing your code.</div><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-uv98YZgJtOA/UwZwlqMlBKI/AAAAAAAAMWY/i68I8z_M-uE/s1600/fry.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-uv98YZgJtOA/UwZwlqMlBKI/AAAAAAAAMWY/i68I8z_M-uE/s1600/fry.png" height="240" width="320" /></a></div><h2 style="text-align: center;"><span style="font-size: large;">So where am I supposed to perform the calls?</span></h2><h3 style="text-align: center;">&nbsp;</h3><div style="text-align: justify;">The answer is pretty simple. Use a Service, which is <i>&#8220;is an application component that can perform long-running operations in the background and does not provide a user interface&#8221;</i>, so it&#8217;s just right for our purpouse. The idea here is to host that <b>rest call inside a service</b>, so it can survive to any activity lifecycle event. </div><div style="text-align: justify;">There are a couple of ways to interact with a service, you can throw intents at it, or you can bind your activities to it. In the latter case, you&#8217;ll get back a reference to the whole service object, and so you are able to implement a rich api your activity can interact with.</div><div style="text-align: justify;">On the other hand, you should be careful and stop your service when you do not need it anymore (ie when all the requests are satisfied), and you should also remember that you (still) need to host your asynchronous interaction inside of some kind of threaded component.&nbsp;</div><div style="text-align: justify;"><br /></div><h3 style="text-align: justify;"><span style="font-size: large;">IntentService!</span></h3><div style="text-align: justify;">Are my favourite flavour of services when speaking of rest interaction. Why is that?</div><ul><li>IntentService(s) provide only a <i>onHandleIntent</i> method, which is performed inside a different thread. No need to spawn an asynctask</li><li>IntentService(s) get destroyed as soon as <i>onHandleIntent</i> returns. No need to understand (or risk to forget) when the service needs to be shut down.</li></ul>Have you ever heard of <a href="http://en.wikipedia.org/wiki/Command_pattern">Command Pattern</a> ? You can just embed your requests parameter inside the intent, parse them in <i>onHandleIntent</i> and let the <i>intentservice</i> execute the request for you. Isn&#8217;t that cool?<br /><br /><br /><h2><span style="font-size: large;">Cool! Now I have the data I retrieved from the service, what should I do with that?</span></h2><div style="text-align: center;"><br /></div><div style="text-align: justify;"><span style="font-size: large;">Store it!</span> The two most common alternatives are <b>plain sqllite or using a content provider</b>. The first benefit of using some kind of persistant storage is that <b>you don&#8217;t want to perform the same costly request twice in order to retrieve the same data</b>.</div><div style="text-align: justify;">Moreover, storing the data enforces the decoupling of your service with the activity, since the activity will fetch the data from the storage, regarless of when the storage was filled. This is also better in terms of user experience, because it&#8217;s better to find some kind of data instead of an empty listview if the device is offline.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Bonus point! If you want to perform the inserts a bit faster, check if you can fetch only new data, if the apis you are consuming are offering any kind of timestamp parameter. Plus, remember to use transactions and bulkinserts in order to speed up your inserts.</div><h2 style="text-align: justify;"></h2><h2 style="text-align: justify;"><span style="font-size: large;">Anything missing?</span></h2><div style="text-align: justify;">Ok, your activity asked to the service to perform the request, the request was performed, the result parsed and stored in your content provider. You should now notify the activity that the storage contains something new.&nbsp;</div><div style="text-align: justify;">You have some options:</div><ul><li>Bind the activity to the service and pass a callback</li><li>Use <a href="http://developer.android.com/reference/android/support/v4/content/LocalBroadcastManager.html">(local) broadcasts </a></li><li>Use a message bus (<a href="http://square.github.io/otto/">Otto</a>, <a href="https://github.com/greenrobot/EventBus">eventbus</a>)</li></ul>Or if you are using a content provider, you could take advantage of CursorLoader / <a href="http://www.grokkingandroid.com/use-contentobserver-to-listen-to-changes/">Observers </a>, which I think are the less error prone way to feed a listview out of a content provider&#8217;s data.<br /><br />You just need to remember to add a couple of lines of code:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-hX1BW7VBeHo/UwZ43lS-BBI/AAAAAAAAMWo/N5b4R1G8AGM/s1600/DroidconIt.034.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-hX1BW7VBeHo/UwZ43lS-BBI/AAAAAAAAMWo/N5b4R1G8AGM/s1600/DroidconIt.034.jpg" height="480" width="640" /></a></div><br /><h2><span style="font-size: large;">Final result:</span></h2><br />The final picture of this kind of architecture is the following (please forgive my extremely bad design skills):<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-GZBxeNRISk0/UwZ5O3Q8D0I/AAAAAAAAMWw/JzGE9krKL88/s1600/DroidconIt.035.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-GZBxeNRISk0/UwZ5O3Q8D0I/AAAAAAAAMWw/JzGE9krKL88/s1600/DroidconIt.035.jpg" height="480" width="640" /></a></div><br />Please note how the the activity asks the Service to perform the request with the webservice and then forgets about it. Any time the data needs to be displayed, it&#8217;s always fetched from the storage.<br />The only other interaction happens when the service tells the activity it needs to reload the data.<br />In this way, any ongoing request will survive even if the activity gets killed. When the user will return to your application, the newly created activity will load the latest fetched data from the storage.<br /><br /><br />This was the first post related to the <b>Rest Interaction in Android</b>. I really hope I did not say too many wrong things&#8230;<br /><br />If you liked this post, consider following me on twitter @fedepaol. <br /><br /><br /><br /></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>kalyanblog</div>
<div class='content'>
HI<br />Nice article.<br />I got a question about one of the common situations, when you get some data from server, that is already sorted on the server, and we don&#39;t have enough fields to sort it on the client. Should we persist this data? And what should we do on another request? Clear table?<br />Thanks</div>
</div>
<div class='comment'>
<div class='author'>Federico Paolinelli</div>
<div class='content'>
@Michal:<br />Let&#39;s distinguish between notifying the activity and then having it update itself. ContentProviders plus loaders offer a full solution via observers, so you don&#39;t have to worry about anything.<br /><br />On the other hand, if you want to notify the activity in some other way, you can:<br />- use a messagebus<br />- use (local) broadcasts<br /><br />Once the activity knows that the underlying storage has new content, again, you have a lot of ways depending on how you stored the data. <br />Again, you can use custom loaders (my favourite one is https://github.com/commonsguy/cwac-loaderex . Alternatively, you can use asynctask, native threads or any async way to interact with your storage.</div>
</div>
<div class='comment'>
<div class='author'>Federico Paolinelli</div>
<div class='content'>
@CristianC:<br />Gave a quick look at your groundy lib, it looks like it&#39;s a slick way to perform async interaction inside a service. My only concern is about passing a callback object instead of registering / unregistering a listener. By doing that, you can only return the result to the calling activity. Worse than that, it looks like (if I understood correctly, sorry it&#39;s a bit late here) you are not using weak references, so you might leak the activity in case the reference is being held but the activity is not active anymore.</div>
</div>
<div class='comment'>
<div class='author'>Michal Kejzlar</div>
<div class='content'>
Thank you for your post, good points there. What would you recommend for observing changes in storage without having Content Provider and loaders? E.g. storing data via dao objects telling to activity via EventBus and then what? Having ugly AsyncTask for querying the database?</div>
</div>
<div class='comment'>
<div class='author'>Cristian C</div>
<div class='content'>
Hi Federico.<br /><br />Have you taken a look at github.com/telly/groundy ?<br /><br />It makes interaction between Service and Activity easier.<br /><br />Disclamer: I wrote the library.</div>
</div>
<div class='comment'>
<div class='author'>Federico Paolinelli</div>
<div class='content'>
@Andy Res:<br /><br />I don&#39;t think you can &quot;natively&quot; stop an intentservice once you launched it. However, what you can do is letting it discover that you are not interested in it anymore. This http://stackoverflow.com/a/7893398/504596 sounds like a reasonable solution. However, despite being a big fan of them, I admit that this is a big limit of IntentService. Another limitation is that you cannot prioritize requests. This is because you are implicitly relying on the Intent queue instead of explicitly using one (or a library that use a queue). In any case, I would also say that in most common use cases, once you start a request you are unlikely to want to delete it. Still, think about updating your twitter feed. If you launch an update, you want the request to be completed even if the user leaves the application.<br />Hope my reply makes sense :-)</div>
</div>
<div class='comment'>
<div class='author'>Federico Paolinelli</div>
<div class='content'>
@Vang:<br /><br />I assume you are talking about how to handle the endless data, not how to display it by using some kind of endless listview. In any case, I&#39;d say that how you want to handle it depends on the data you want to display and on the kind of your application. If you really have an &quot;endless&quot; == almost infinite amount of content, what you can do is just provide a &quot;window&quot; on the data that is held on the server, the same way any twitter client does by showing only the latest tweets and by performing a new get whenever you approach the end of the list. If, on the other hand, you have a HUGE amount of content you always want to be synched on your device, this is a more complex topic to discuss. The &quot;easiest&quot; way would be letting the remote server be the master of your data, and perform a full delete before you download all the new data. From that, several optimizations can be implemented. One can be having a timestamp related to the whole resource, and not performing the sync if your device already has the latest version. More complex optimizations are harder to implement by using a restful interface, because you can&#39;t tell it &quot;just send me the data changed since xxx or even the data deleted since xxx&quot; in order to allow you to apply those differences (at least, not that I am aware of). Sorry for the delay in the reply, but I have been a bit busy in the latest couple of days.<br /><br /></div>
</div>
<div class='comment'>
<div class='author'>Andy Res</div>
<div class='content'>
Thank you for the very useful info.<br /><br />What could you tell in regards to requests cancelation while using IntentService?<br /><br /><br /><br /></div>
</div>
<div class='comment'>
<div class='author'>Vang</div>
<div class='content'>
Hello, Federico. Could you explain how can we handle a case with endless list of content? As i understand we should download all content and find changes to persist. In general the main question is: How to maintain consistency beetween remote and local database? Thank you.</div>
</div>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/29/contributing-to-firefox-for-android/">Contributing to Firefox for Android</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-07-29'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
<br />In the past two / three years I have been (mostly) developing Android code, <a href="/blog/2010/11/10/something-more-about-me">even before it was cool</a>(tm), as a way to do something different from what I do during my day time job.<br /><br />I wrote some <a href="https://play.google.com/store/search?q=federico+paolinelli&amp;c=apps">apps</a>, a couple of <a href="https://github.com/fedepaol">libraries</a>, and some 80% finished projects I really hope I will finish some day.<br /><br />Recently I thought that joining some big android related open source project could have been interesting, and I went for them.<br /><br /><br />That&#8217;s <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=731491">when</a> I found <a href="https://play.google.com/store/apps/details?id=org.mozilla.firefox">Firefox for Android</a> (code name fennec). There are several reasons why I choose it. It&#8217;s one of the most complex / active open source projects, I <a href="http://www.joshmatthews.net/fosdem/">spotted these slides</a> on my g+ stream and I decided to give it a spin.<br /><br /><a href="http://www.flickr.com/photos/tambako/5964400251/"><img src="http://farm7.staticflickr.com/6126/5964400251_8dd37a206a.jpg" /></a><br /><br /><span style="font-size: xx-small;">(Some rights reserved, cc licenze by &#8220;Tambako the Jaguar&#8221;)</span><br /><br /><br /> I must admit that I was not using fennec as my primary browser on android.<br /><br />This is my first experience in a (quite) big open source software project, and now I spend on fennec all of the free time I devote to developing (and I really like it).<br /><br /> <br /><h3> What was *totally* a surprise,</h3>&nbsp; is the fact that fennec is very far from a &#8220;plain android&#8221; project. When I first started, I (wrongly) expected to find an android project where I could reuse the stuff I knew from before, and I ended up working on a lot of javascript (which I never used before).  The project is various and I like the mixture of js, c++ and regular android, and I find this challenging, even if the code read / written ratio has become really huge. Hope this will get better with time.<br /><br /><br /><br /><h3> Working on it is harder than a regular android project.</h3>&nbsp; Forget intellij, eclipse or android studio. Forget debugging, or at least expect attaching a command line debugger to your code to be tricky. Slow build time (a full build takes something like 2 hour and half on my laptop).<br />Incremental builds time and upload to the device may take up to 2-3 minutes. I got back to the really old times when I wrote most of my code using vim and figuring out what was happening through logs.<br /><br /><br /><h3> You can get a lot of help from the mobile team,</h3>&nbsp; but you need to ask. A lot. Think of your average day. A lot of work to be done. Bugs coming, code to be written. Now think about some guy, who never wrote a line of code on the project you are working on, coming and asking some dumb or obvious questions. You are that guy.<br />That&#8217;s what must be their point of view (hope I am making less dumb questions). But they are helpful, even on monday mornings. You just have to ping <a href="https://wiki.mozilla.org/IRC">them on irc.</a><br /><br /><br /><h3> Did I say it is hard at first?</h3>&nbsp; The <a href="http://www.joshmatthews.net/bugsahoy/?mobile=1">bugs ahoy page</a> makes it quite easy to find a bug to start with, and the <a href="https://wiki.mozilla.org/Mobile/Fennec/Android">build instructions</a> are dumb proof. But then, it feels like being thrown in the middle of the jungle with a pocket knife. A huge codebase, xul interfaces, javascript, C++ code, Xpcom interfaces, no idea of which function is calling what. <br />The documentation is there, but it&#8217;s hard to figure out where to start from.<br />But if you are not worried about pinging and pinging people on irc, you will be given all the answers you need in order to get better and go ahead, and you will learn about all the tools at your disposal that help a distributed team to work better, such as <a href="http://mxr.mozilla.org/">mxr</a>, <a href="http://pastebin.mozilla.org/">pastebin</a> and <a href="https://etherpad.mozilla.org/">mopad</a>, or <a href="https://developer.mozilla.org/en-US/docs/Developer_Guide/How_to_Submit_a_Patch">how to submit a patch</a>&nbsp;using <a href="https://developer.mozilla.org/en-US/docs/Mercurial_Queues">hg queues</a>.<br /><br /><br /><h3> Is it worth it?</h3><b>&nbsp; Definetely</b>. As I wrote before, I am currently spending all the spare time I devote to side projects writing code for Fennec. Or I should say, reading a lot of code and writing some code. The &#8220;aha&#8221; moment when you realize that you understand how things work after grepping and digging into interfaces and callbacks has no price and it&#8217;s something I haven&#8217;t experienced for a long time.<br />Moreover, it&#8217;s exciting to interact with the mobile team, they all are passionate about what they are doing and very capable, not to mention that you will be forced to produce high quality code in order to pass the reviews.<br /><b>&nbsp; Finally</b>, the fact that you are contributing something bigger than that <a href="https://play.google.com/store/apps/details?id=com.whiterabbit.pastimer.lite">pasta cooking timer app</a> , and that your code will run in the hands of a lot of users is huge. I am not an opensource software integralist, despite having written a decent amount of it, but the <b>freedom message shared by the mozilla foundation is something it feels nice to be part of.</b><br /><br /><br /> <br /> Not to mention the tshirt I received and the &#8221;<a href="https://badges.mozilla.org/en-US/badges/badge/Friends-of-the-Mobile-Team/awards/1002">friend of mobile team</a>&#8221; badge I was awarded :-)<br /><br /><a href="http://1.bp.blogspot.com/-Qrsy0iSfC-w/UfbaCd153iI/AAAAAAAAMCA/iW7Pa0xXMFI/s1600/IMG_20130729_224220.jpg"><img border="0" src="http://1.bp.blogspot.com/-Qrsy0iSfC-w/UfbaCd153iI/AAAAAAAAMCA/iW7Pa0xXMFI/s320/IMG_20130729_224220.jpg" /></a><br /><br /><br /><br /><br /></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Federico Paolinelli</div>
<div class='content'>
Thanks mrlachatte. Did not realize that my first contribution was getting live until now!</div>
</div>
<div class='comment'>
<div class='author'>mrlachatte</div>
<div class='content'>
It&#39;s FF 23 release day, and I saw your name in the list on https://blog.mozilla.org/community/2013/08/05/firefox-23-new-contributors/. Congratulations on having your first contribution be released to our many users!</div>
</div>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/03/06/postman-ringstwice-reloaded-android/">PostMan (RingsTwice) Reloaded - Android Rest and Oauth Make Easy(er)</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-03-06'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
<h3><span style="font-size: large;"><br /></span></h3><h3><span style="font-size: large;">Android and Rest</span></h3><div><span style="font-size: large;"><br /></span></div><div><span style="font-size: large;"><br /></span></div>My <a href="https://github.com/fedepaol/PostmanLib--Rings-Twice--Android">PostManLib android library</a> had a quite troubled genesis. Some infos can be found in this <a href="/blog/2012/01/30/postmanlib-android-and-rest-web">old post</a>&nbsp;, but bear in mind that I only kept the skeleton of what I wrote at that time (which, by the way, was inspired by&nbsp;<a href="http://www.youtube.com/watch?v=xHXn3Kg2IQE">this</a>&nbsp;talk).<br /><br />The api was (to be kind) a bit clunky, and I recently chose to rewrite / finish it. Apart from its clunkyness, one thing was missing:<br /><br /><h3>OAuth Authentication</h3><div>OAuth authentication is quite common for android apps, since it is a widely supported authentication system. Looking for &#8220;inspiration&#8221; I came across&nbsp;<a href="https://github.com/fernandezpablo85/scribe-java">https://github.com/fernandezpablo85/scribe-java</a>&nbsp;which not only provides oauth out of the box, but already provides a good and well tested abstraction for http rest interactions. I then chose not to reinvent the wheel and to delegate oauth and http interaction entirely to scribe.</div><div><br /></div><h3>Why asynchronous rest calls in android are important:</h3><div><br /></div><div>In android, performing time consuming work in the ui thread may result in ANR errors, and obviously rest calls belong to this category. What postmanlib does is to decouple the requests and execute them inside intent services, providing a way to get notified of calls results.</div><h3></h3><h3>What postmanlib offers:</h3><div><br /></div><div><ul><li>OAuth login using a webview hosted inside a fragment dialog. Every interaction is performed asynchronously. Just call registerOAuthService<span style="color: #333333; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 12px; line-height: 19px;">&nbsp;</span>and the registration will happen</li><li>Asynchronous rest calls (oauth-ed or not) performed inside an intent service</li><li>Multiple api handling - token storage</li></ul><div><br /></div></div><div>Given that the interaction is performed inside an intent service, all the well known problems related to asynctasks are avoided.&nbsp;</div><div><br /></div><h3></h3><h3>What postmanlib does not offer:</h3><div><br /></div><div><ul><li>Storage: the data received in background can be stored in the user&#8217;s favorite storage. I strongly suggest to use a content provider, using my automatic <a href="blog/2012/11/11/android-content-providers-generator.html">content provider generator</a></li><li>Parsing: the plain text received must be interpreted. There is plenty of json / xml parsing library, just pick one</li></ul></div><div><br /></div><h2><span style="font-weight: normal;"><span style="font-size: x-large;"><br /></span></span></h2><h2><span style="font-weight: normal;"><span style="font-size: x-large;"><br /></span></span></h2><h2><span style="font-weight: normal;"><span style="font-size: x-large;">Library Architecture</span></span></h2><div><span style="font-weight: normal;"><br /></span></div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://raw.github.com/fedepaol/PostmanLib--Rings-Twice--Android/master/images/postman.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="https://raw.github.com/fedepaol/PostmanLib--Rings-Twice--Android/master/images/postman.png" width="352" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: left;">A singleton object collects the requests to perform the rest calls in background.&nbsp;</div><div class="separator" style="clear: both; text-align: left;">The requests are parcelable objects that are passed inside an intent to the intent services. Using the command pattern along with the strategy pattern to implement the interaction resulted in a much cleaner api (more details about the structure can be found in the <a href="https://github.com/fedepaol/PostmanLib--Rings-Twice--Android">git repository</a>).</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">All the client application has to do is to perform oauth requests is to create and register a oauthservice builder.&nbsp;</div><div class="separator" style="clear: both; text-align: left;">I had to wrap the original scribe oauth service builder because I had to store all the tokens in order to restore them whenever the singleton is garbage collected.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">After performing the registration (which is done using a OAuthHelper class), a registered api can be used to sign any request sent. The only difference between oauth-ed and plain requests is that in the first case we specify a signer.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><br /></div><h2></h2><h2 id="yui_3_7_3_1_1362605099013_692" style="background-color: #dedede; color: #222222; font-family: 'Bree Serif'; font-size: 26px; font-weight: 400; line-height: 28px; margin: 1.5em 0px; text-transform: capitalize;">TL;DR</h2><div><br /></div><div class="p4" style="background-color: #dedede; color: #2b2b2b; font-family: 'Source Sans Pro'; font-size: 22px; font-weight: normal; line-height: 33px; margin-bottom: 1.5em;"><strong style="margin-bottom: 0px; margin-top: 0px;"></strong></div><div class="separator" style="clear: both; text-align: left;">I really like the way the library grew up (not just because I wrote it :-) ). Scribe performs an excellent job in abstracting oauth registration and http interaction, so I could focus on asynchronous interaction with it.</div><div class="separator" style="clear: both; text-align: left;">The registration process is more than trivial, and rest requests are strongly decoupled from the activities.</div><div class="separator" style="clear: both; text-align: left;">As told earlier, it can be found here:&nbsp;<a href="https://github.com/fedepaol/PostmanLib--Rings-Twice--Android">https://github.com/fedepaol/PostmanLib&#8211;Rings-Twice&#8211;Android</a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">I think this library might be of some help to anybody who wants to interact with webservices and want to go beyond the too often badly used async tasks.</div><div class="separator" style="clear: both; text-align: left;">A real world sample (with no oauth, sorry) can be found in my <a href="https://github.com/fedepaol/AndAppennino">AndAppennino application</a>.&nbsp;</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div><br /></div></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Federico Paolinelli</div>
<div class='content'>
Grazie mille :-), cerco di darmi da fare come riesco, troppo buono a mettermi sullo stesso piano di Gabriele.. <br />Ho visto la pull request, appena ho un attimo ci faccio un giro e la mergio, adesso sono un po&#39; preso dall&#39;arrivo di una figlia :-)<br /><br />Grazie ancora per le (troppo) buone parole.</div>
</div>
<div class='comment'>
<div class='author'>Alessandro Bellesia</div>
<div class='content'>
Ciao Federico! Innanzitutto ti faccio i miei complimenti per l&#39;ottimo progetto. Si tratta di una soluzione davvero molto completa e comoda perch gi pronta out-of-the-box. <br /><br />Grazie a te ed a Gabriele Mariotti praticamente l&#39;Android Weekly  tutta italiana! Sono davvero molto contento. <br /><br />Giocando un po con la libreria mi sono accorto che la funzione isServiceEnabled nel ServerInteractionHelper non funziona nel modo corretto. I numero di Services infatti risulta sempre 4 a prescindere dai servizi effettivamente impostati nel manifest dell&#39;app.<br /><br />Mi sono permesso di fare una piccola pull request su GitHub con la mia proposta di correzione!<br /><br />Grazie mille ed ancora complimenti!<br /><br />Saluti,<br />Alessandro.<br /><br /><br /><br /></div>
</div>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/11/25/droidalone-reloaded/">DroidAlone - Reloaded</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-11-25'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Whenever I speak with another android developer, the occasional chat goes to &#8220;what did you develop?&#8221; question.<br />Last time it happened at droidcon uk, and for the first time I felt something wasn&#8217;t completely right when I showed my DroidAlone app.<br /><br />DroidAlone is a useful app (so they say) that comes into play whenever you forget your phone at home. With a simple sms protected by a password choosen by the user, it can be activated. From that moment, it will start notifying you of any missed calls and sms. It also ships a lot of other nice features, such as phone location retrieval and auto reply via sms (if you want to inform the caller that he can reach you to another number).<br />The full description of DroidAlone can be found at&nbsp;<a href="http://www.fedepaolapps.com/app/droidalone/">Missed Calls for Android</a>&nbsp;.<br /><br />Everything seems to work well, it has a lot of good reviews and the few users are happy.<br />Except one thing. It looks (looked) like this:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://www.fedepaolapps.com/wp-content/uploads/2012/09/main_screen1.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://www.fedepaolapps.com/wp-content/uploads/2012/09/main_screen1.jpg" width="213" /></a></div><a href="http://www.blogger.com/"></a><span id="goog_1451563458"></span><span id="goog_1451563459"></span><br />It also had another view with the list of events. The other developer&#8217;s reaction was &#8220;ugh&#8221;. And then I realized that I can&#8217;t keep producing new stuff ignoring what I have around, especially if this is the case of the only app I manage to sell a bit.<br /><br />So, when I got home I decided to change the ui &#8220;just to make it more pleasant&#8221;. &nbsp;Then I opened the code, and I realized that my two year&#8217;s old code needed a bit more than a refresh.<br /><br />Here what was wrong:<br /><br /><ul><li>it used tabactivity, which is very old fashioned. I decided to add the actionbar.</li><li>from the event list view, you had to click on the item to see the details of the event. The details where shown into a dialog. Ugh (again). In the new version I wanted all the details to be visible since they are not so long.</li><li>All the properties of the views in the layouts where explicit. No styles anywhere. The color resources where &#8220;background_color&#8221;, or &#8220;title_color&#8221; instead of some name that remind you the color. I had to put a heavy hand on that.</li><li>I tried to use gridlayout a lot since it seem to be the more efficient way to dispose a layout.</li><li>There was no empty list information.</li><li>A lot of calls where deprecated. I switched to the most modern versions.</li><li>All the data was contained in a sqllite storage without using a content provider. I switched to using a content provider and a cursorloader, which ended up in a more compact code. I didn&#8217;t need anymore to use a broadcast to notify the ui that the data was changed.</li><li>DroidAlone uses broadcast receivers to be notified of incoming calls / sms. Even tough the sms receiver must be enabled because an activation sms can be received at anytime, the call receiver is needed only when the app is active. I then used the package manager to disable it when not needed.</li><li>I wanted to refactor a lot of code. A lot of brackets where on the new line instead of the same line of the method (a la C), and it bothered me a lot. I also trusted lint and changed a lot here and there.&nbsp;</li></ul><div><br /></div><div>Other than these things, I redraw (by my self) a lot of the assets using inkscape. Because I soon got bored to export the resources in 4 different resolutions folders, I wrote a simple python script to do that for me. You can find it <a href="https://gist.github.com/4127778">here</a>&nbsp;.</div><div><br /></div><div>More than that, I got REALLY REALLY bored while writing the content provider, so I ended up writing another python script to automatically generate the content provider for me, as described in my previous <a href="/blog/2012/11/11/android-content-providers-generator">post</a>. You can find the <a href="https://github.com/fedepaol/Android-sql-lite-helper">android content provider generator here</a>.&nbsp;</div><div><br /></div><div>Finally, I switched the project to maven because I am getting used to that solution, especially in case I want to add robolectric tests and keep working with intellij.</div><div><br /></div><div>The new version of the app hasn&#8217;t been released yet (I want to have it running for a while on my phone before releasing it, just to be sure that I didn&#8217;t break anything).</div><div><br /></div><div>This is how the new version will look like&nbsp;</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-KFbMTLsxs5w/ULKCXaGOnLI/AAAAAAAAJS4/CVeElRWX6wA/s1600/screen3.tiff" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://1.bp.blogspot.com/-KFbMTLsxs5w/ULKCXaGOnLI/AAAAAAAAJS4/CVeElRWX6wA/s320/screen3.tiff" width="194" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: left;">So, this is how a &#8220;little ui polishing&#8221; ended lasting more than two weeks (of my spare time). I am also glad that I think my old code is not that good. I like to think that I am better than two years ago.</div><div><br /></div><br /><div class="separator" style="clear: both; text-align: center;"><br /></div><br /></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/11/11/android-content-providers-generator/">Android Content Providers Generator</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-11-11'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
During the refactoring of my two years old app DroidAlone, I decided to try to access to the storage through a ContentProvider.<br /><br />Even if the official documentation warns that there is no need to use content providers if your app does not want to export it&#8217;s data against other apps, there are a bunch of advantages in using a content provider in your app.<br /><br />The main and more obvious advantage is that you can use a Loader with your data. Using loaders relieve you from managing the cursor, forgetting open cursors here and there and most of all, makes a lot easier for your ui to react to changes in your model. Well, more than easier, you don&#8217;t have to do anything.<br /><br />However, I am not writing this post to describe how to interact with an android content provider, nor how to implement a content provider. There are a lot of content provider tutorials out there that probably can explain how them work better than I could possibly ever do (and in a better English).<br /><br />I am writing this post because while writing the content provider, I got bored.<br />It&#8217;s a lot of code, always the same, that cannot be avoided, and you don&#8217;t have to add any value to it. The best thing you can do is not getting distracted and write it with no errors. And it&#8217;s loong (ok, not that long).<br /><br />Given the &#8220;boilerplateness&#8221; of this problem, I thought I could take off some dust from my old <a href="/blog/2010/11/18/my-sqllite-helper-builder">SqliteHelper builder script</a>&nbsp;and maybe make it able to generate the content provider class for me. And that&#8217;s what I did.<br /><br /><h3>Android Content Provider Generator</h3><br /><a href="https://github.com/fedepaol/Android-sql-lite-helper">https://github.com/fedepaol/Android-sql-lite-helper</a><br /><br />I added a couple of options to it, and now it can generate automatically for you (no more cut/paste, no more forgotten columns) the content provider class AND a client class with a bunch of methods you can use to add / update / delete / query your data.<br />A sample of the generated code is already included in the beta of my app and it seems to work properly.<br /><br />I won&#8217;t write any instructions or examples here, they are already in the github repo.<br /><b>All you need to know is that with a 10 rows text file that describes your data, you can generate the whole content provider</b>.<br /><br />As <a href="https://plus.google.com/105096943850026101634/posts/RTbp2zVPZQq">I wrote on G+</a>, it&#8217;s certainly not the most elegant piece of python I wrote, but it makes it&#8217;s job.<br /><br /><br /><br />If you liked this post (or my script), consider following me on twitter @fedepaol<br /><br /></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/10/29/droidconuk-2012/">DroidconUk 2012</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2012-10-29'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Here I am, back again from my third DroidconUk experience.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-dfNEw8CwymY/UI7dRBZVlzI/AAAAAAAAJBw/JqUhyGTyHZE/s1600/IMG_20121029_204517.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="240" src="http://1.bp.blogspot.com/-dfNEw8CwymY/UI7dRBZVlzI/AAAAAAAAJBw/JqUhyGTyHZE/s320/IMG_20121029_204517.jpg" width="320" /></a></div><br /><br />I can still remember explaining to my non tech friends what Android was the evening of the 1st droidcon, and since then it became a sort of ritual, a couple of days when I can take some rest from my day time job and take part to the community of some of the best android developers coming from all over the Europe.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-YsYHqWhHMHk/UI7eDIWeCqI/AAAAAAAAJCA/b3Dv80SwVLk/s1600/IMG_20121026_190855.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="240" src="http://1.bp.blogspot.com/-YsYHqWhHMHk/UI7eDIWeCqI/AAAAAAAAJCA/b3Dv80SwVLk/s320/IMG_20121026_190855.jpg" width="320" /></a></div><br /><br /><br />It&#8217;s an (almost) cheap to flight from Pisa (IT) where I live to London, and I can always count on my architect friends from <a href="http://www.marcelmauer.eu/">Marcel Mauer</a> for accommodation.<br /><br /><br />My overall impression is that droidcon is getting better and better. It&#8217;s growing as much as the Android &nbsp;platform itself, and despite all the interesting talks the better part is still the people you can meet there BETWEEN the talks. Even if you are as shy and sociopath as I am.<br /><br /><br />Most of the talks where very instructive and I heard about a lot of new stuff I can reuse on my side projects.<br /><br /><br /><br />Here I will put a short list of what are the things I liked most (as a kind reminder for me but also for any occasional reader that lands on this page by chance).<br /><br /><br /><br /><h2>The talks:</h2><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-cJwI92KmcAA/UI7hSI-I9wI/AAAAAAAAJDY/PcojASjug88/s1600/IMG_20121025_142744.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="240" src="http://1.bp.blogspot.com/-cJwI92KmcAA/UI7hSI-I9wI/AAAAAAAAJDY/PcojASjug88/s320/IMG_20121025_142744.jpg" width="320" /></a></div><div><br /></div><div class="separator" style="clear: both; text-align: center;"></div><div><br /></div><div>I am not following a proper order if not the chronological one. I really enjoyed all the talks.</div><h3>The keynotes:</h3>It&#8217;s official. They are putting Android everywhere. Three keynotes for three Android related product which where not phones nor tablets.<br />- Ouya, the famous kickstarter funded android gaming console<br />- Vendscreen, an android based vending machine (!)<br />- Parrot android based car stereos.<br /><br /><h3>Building songkick for Android&nbsp;(<a href="https://speakerdeck.com/jdamcd/building-songkick-on-android">slides</a>):</h3>Askay and Jamie from Novoda show their professional approach to build the songkick app. A lot of interesting tips and best practices from them. Really liked the &#8220;writing good code is always faster than writing bad code&#8221; approach.<br /><br /><h3>Overcoming device fragmentation:</h3>Jan and Jon from SoundCloud had a bad time dealing with sound infrastructure in Android, especially from a multi device perspective.<br />It&#8217;s not an aspect of the platform I have never addressed that much, but I really enjoyed their story about going from the simple system call up to get the hands dirty with bringing on board ogg library through ndk. I also liked the fact that at first they tried to deal with java version, because it&#8217;s something I would do as well.<br /><br /><h3>The fly in app menu for designers and developers (<a href="https://speakerdeck.com/cyrilmottier/the-fly-in-app-menu-for-designers-and-developers">slides</a>):</h3>Cyril Mottier (&nbsp;we may remember him for Greendroid) made a gorgeous presentation on this navigation pattern which is getting more and more popular (but don&#8217;t use it just because it&#8217;s  la mode).<br />The presentation was a proper walkthrough on why and when one should use the new pattern (and when one shouldn&#8217;t). During the talk he gave a lot of tips on how the correct user experience should be. Very inspiring.<br />If you want to bring this pattern in your app and you can&#8217;t affort to develop it &#8220;in house&#8221; as Cyril did, there are a couple of libraries that implement it for us:<br /><a href="https://github.com/eddieringle/android-undergarment">https://github.com/eddieringle/android-undergarment</a><br /><a href="https://github.com/jfeinstein10/SlidingMenu">https://github.com/jfeinstein10/SlidingMenu</a><br /><a href="https://github.com/SimonVT/android-menudrawer">https://github.com/SimonVT/android-menudrawer</a><br /><br /><br /><h3>Beaming data to devices with nfc (<a href="http://www.slideshare.net/commonsguy/beaming-data-to-devices-with-nfc">slides</a>):</h3>Mark Murphy from CommonsWare introduced what (and how) can be done with an nfc enabled phone through a royalty free spy story. Interesting and funny as always, the talk of Mark is worth the ticket by itself (well, his talk and the free beers I had).<br />It&#8217;s a good starting point when I will look into nfc, which might be very soon.<br /><br /><br /><h3>Fast, user friendly and power efficient network communication with android (<a href="http://developer.sonymobile.com/downloads/documentation/fast-user-friendly-and-power-efficient-network-communication-on-android/">slides</a>):&nbsp;</h3>Another series of super tips from Erik Hellman on how you should perform networking in a proper manner.<br />Still, stuff I read here and there but still useful.<br />He also mentioned <a href="http://netty.io/">netty.io</a> library, which is something I should definitely check, since my current project involves plain socket operation and I implemented it my self (the android way).<br /><br /><br /><h3>Introduction to Google Tv (<a href="http://www.slideshare.net/OpenWorldForum/owf12paug-conf-days-google-tv-part-1-introduction-matt-gaunt-advocate-at-google">slides</a>):</h3><div>Google Tv looks to be the next big thing. I have never dig into the docs but it really looks like a new whole world. Apart from the different challenges that we can have developing a tv ui, I really like the idea of having it interact with our personal devices.</div><br /><br /><br /><h2>The libraries:</h2><br /><h3>Polaris (<a href="https://github.com/cyrilmottier/Polaris">link</a>):</h3><a href="http://android.cyrilmottier.com/">Cyril Mottier</a>&nbsp;(yes, still him) delighted us with Polaris, his map library to enhance the poor experience available from standard map apis.<br /><br /><h3>RoboSpice (<a href="https://github.com/octo-online/robospice">link</a>):</h3><div>The french guys from Octo (sorry I can&#8217;t remember the name of the speaker) presented their awesome RoboSpice library, a library to perform asynchronous jobs (and a lot more) on steroids.&nbsp;</div><div>I was really interested in this talk because of my previous attempt to build something (barely) similar with&nbsp;<a href="/blog/2012/01/postmanlib-android-and-rest-web.html">Postman Lib</a>&nbsp;. Unfortunately I never had time to polish it and it&#8217;s still an unfinished product. Moreover, the guys from Octo made a better job under every aspect of object reusing and performance, dealing with issues I would have never fix even if I took the library to a decent state. I am quite curious to dig into their code just for the fun of it :-)</div><div><br /></div><h3>OpenCv:</h3><div>Erik Hellman from Sony introduced how opencv library for computer vision can be (almost) easily integrated into an android app. Still, something I would always loved to play with, maybe I will if I get some extra spare time.</div><br /><br /><h3>NetMera (<a href="http://www.netmera.com/pages/web/home">link</a>):</h3>Well, this is not a real library, but it&#8217;s a brand new concept (at least, new to me) for a platform as an sdk. &nbsp;It was introduced by Friedger Muffke during his talk&nbsp;<a href="https://docs.google.com/presentation/d/1GjAWqrB-OrEtsoudPLMq1KUEwjSuPygHmNBjv1FEq0A/edit">&#8220;Serverless Android Applications&#8221;</a>. They provide a full remote backend without having you bother at all for it. Sounds like the holy grail for&nbsp;<i>developers with no time(tm)&nbsp;</i>but I don&#8217;t like the idea of having my code bound to a specific service.<br /><br /><br /><h2>Talks I missed:</h2><div>I was told that this talks were excellent:</div><div>- <a href="http://prezi.com/fh2uslbr1xs3/the-fragment-transition/">The fragment transition</a>&nbsp;by Corey Latislaw</div><div>- <a href="https://docs.google.com/presentation/d/1OcGVS5bci9jaYiI7uvXFf9asj5TS4xZa72LX-i8lEcs/present#slide=id.p25">Writing games for an Android video game console</a>&nbsp;by Al Sutton</div><div>- Proguard by Eric Lafortune</div><div>-&nbsp;Dynamic animations with custom views by Anders Ericsson</div><br /><br /><h2>Epilogue:</h2>I had a great time at droidcon, I really enjoyed it under every aspect (even though I suspect I still have to digest an hotdog of two from the dinner of Thursday). It really boosted my hunger for learning new things. As an immediate effect I decided to polish my old apps, those I developed three years ago which now look ugly and old (the code as well).<br /><br />See you next year, DroidConUk!<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-yzyd64vYHrA/UI7eL43qhqI/AAAAAAAAJCI/Ua-AJTnGAu8/s1600/IMG_20121027_072842.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://2.bp.blogspot.com/-yzyd64vYHrA/UI7eL43qhqI/AAAAAAAAJCI/Ua-AJTnGAu8/s320/IMG_20121027_072842.jpg" width="240" /></a></div><span style="font-size: x-small;">(This picture was taken at Liverpool Street while waiting for the bus to Stanstead Airport). Way too early for a Saturday morning.</span><br /><br /><br /></div>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p>Lead developer with electronic trading software by day, passionate about mobile. I spend a lot of my spare time writing software for android. Table Tennis player, snowboarder, dad. I also contribute to Firefox for Android.</p>
  <a href="mailto:fedepaol@gmail.com" target="_top">fedepaol@gmail.com</a>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/09/04/its-been-a-while/">It's Been a While</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/01/dragging-with-viewdraghelper/">Dragging With ViewDragHelper</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/24/migrating-from-blogger-to-octopress-done/">Migrating From Blogger to Octopress (Done!)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/08/preloading-localized-data-in-sqllte/">Generating Preloaded Sqlite Data</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/20/rest-interaction-in-android/">Rest Interaction in Android</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/fedepaol">@fedepaol</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'fedepaol',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/+FedericoPaolinelli?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



<section>
	<h1>On Twitter:</h1>
	<div>
		<p><br /><a href="http://twitter.com/fedepaol" target="_blank">My Tweets, on Twitter.</a></p>
		<a href="http://twitter.com/fedepaol" class="twitter-follow-button" data-show-count="">Follow @fedepaol</a>
	</div>
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Federico Paolinelli -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'fedepaolgithubio';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
