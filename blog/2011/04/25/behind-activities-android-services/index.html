
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Behind Activities: Android, Services, Background Operations and Threads - My little Android warehouse</title>
  <meta name="author" content="Federico Paolinelli">

  
  <meta name="description" content="This time I want to share something I learned about working in background on android.One of the biggest advantages of android over ios (or, at least &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://fedepaol.github.io/blog/2011/04/25/behind-activities-android-services">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="My little Android warehouse" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16514009-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My little Android warehouse</a></h1>
  
    <h2>Random thoughts about my experience as moonlight android developer.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:fedepaol.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Behind Activities: Android, Services, Background Operations and Threads</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-04-25'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><div class='post'>
This time I want to share something I learned about working in background on android.<br /><br />One of the biggest advantages of android over ios (or, at least, some ios version ago) is that your app is not sandboxed and can continue to live in background.<br /><br />To perform background (not visible) work, all you need to know is how to use android services.<br /><br />A service is a piece of an application that is allowed to be active even if the application is not in foreground anymore. The most commonly used example for describing a service is the music player, which need to continue to play music when your app is hidden by something else.<br /><br />First of all, I want to remark a concept I had some problems with: a service does not have any relationship with threads! The service shares the main (ui) thread with the rest of the components of the app. This means that, if your app is in foreground AND you have a service active AND your service performs some time consuming operations, it will affect the responsivness of the gui (and you don't want to disappoint your user).<br />So, even if you are now able to perform some background work, if you expect it to be heavy, please move it inside a thread (or an asynctask) hosted by the service.<br /><br />Another advantage of bringing a service on board is that your application will gain priority over the other apps. Android prefers to kill processes that do not have active services. On the other hand, this means that you should use services carefully if you don't want to drain your user's battery. If you don't need a service anymore, please kill it and restart it later (as pointed out from mark murphy in this old but interesting article: <a href="http://www.androidguys.com/2009/09/09/diamonds-are-forever-services-are-not/">http://www.androidguys.com/2009/09/09/diamonds-are-forever-services-are-not/</a>)<br /><br />Said that, I am now going to list some typical service usage patterns<br /><br /><ul><li><span class="Apple-style-span" style="color: red;">Listen and react to events from outside </span>which need to be handled even if the application is not active (and maybe when the device is idle), such as location variation, accelerometer, incoming calls and so on</li><li><span class="Apple-style-span" style="color: red;">Tasks that need to be performed periodically</span>, like polling a mail server every 15 minutes</li><li><span class="Apple-style-span" style="color: red;">Continuous tasks</span> (like playing a song, or sampling the location with a very narrow interval) that need to be performed in background</li></ul><br /><br />I would say the first two are similar, and the third needs to be handled in a different way.<br /><br /><br /><span class="Apple-style-span" style="font-size: large;"><b>One shot tasks</b></span><br />If you need one shot tasks (like downloading your email), you could:<br /><br /><ol><li>start a service with an <i>intent</i></li><li>return <i>START_NOT_STICKY</i> in its <i>onCommand</i> callback</li><li><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">start an <i>AsyncTask</i> to perform the heavy operations</div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"><br /></div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">OR</div></li></ol><br /><div style="text-align: center;"><b><span class="Apple-style-span" style="color: red;"><u>you can use an IntentService.&nbsp;</u></span></b></div><div style="text-align: center;"><br /></div>IntentServices are useful as much as they are little advertised.<br />If your service is an intentservice, it will be automatically hosted in its own thread. You can send it as many actions to be performed you want bundled in intents. They will be queued and handled one at a time.<br />You don't even have to bother if you need to shut the service down. It will automatically shut down when you return from the <i>onHandleIntent</i> call.&nbsp;Much simple, isn't it?<br /><br />Here are some simple scenarios for using intent services:<br /><br /><ul><li><span class="Apple-style-span" style="color: red;">Background operation triggered from user</span> (such as a button):&nbsp;Just pack the command in an intent, and launch the service with the intent.</li><li><span class="Apple-style-span" style="color: red;">React to some broadcast event</span> (such as some system broadcast event):&nbsp;Register a broadcast receiver in your manifest and then launch the intent service from its onReceive. You can't handle long running operations in the broadcast receiver, there is a strict time limit in broadcast handling.</li><li><span class="Apple-style-span" style="color: red;">Perform periodic tasks</span>: Use an alarm manager and make it launch your intent service. I also remind you that using setInexactRepeating in this case will help your&nbsp;app to save more resources.</li></ul><br /><br /><b><span class="Apple-style-span" style="font-size: large;">Long running tasks</span></b><br /><br />If you need to need to perform long, continuous background operations, you have no options, and you need a classic service, returning <i>START_STICKY</i> in its <i>onCommand()</i> method.<br />Again, remember that in this case you need to perform time consuming operations inside a thread or an asynctask, because the service shares the same thread with the gui.<br /><br /><br /><br /><a name='more'></a><br /><br /><br />The next time I will try to write down some more practical stuff on how to implement activities and services communication.<br /><br /><br />If I wasn't clear enough, if you broke your phone trying to implement this advices, or if you think I'd better shoot in my foot than writing this ugly stuff in a very poor engRish, drop me an email fedepaol <at> gmail.com .</at><br />If you liked this post, you can consider following me on twitter @fedepaol .<br /><br /><br />UPDATE: I am currently (23/01/2012) working on a library to be used to interact with a service using an intent service. In case you may be interested, you can find it here&nbsp;<a href="https://github.com/fedepaol/PostmanLib--Rings-Twice--Android">PostmanLib - Android webservice interaction</a><br /><br /><div><br /></div></div>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Federico Paolinelli</span></span>

      




<time class='entry-date' datetime='2011-04-25'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2011</span></span> <span class='time'>12:00 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/android/'>android</a>, <a class='category' href='/blog/categories/background/'>background</a>, <a class='category' href='/blog/categories/intentservice/'>intentservice</a>, <a class='category' href='/blog/categories/service/'>service</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://fedepaol.github.io/blog/2011/04/25/behind-activities-android-services/" data-via="fedepaol" data-counturl="http://fedepaol.github.io/blog/2011/04/25/behind-activities-android-services/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/03/21/first-18-days-of-pegdroid/" title="Previous Post: first 18 days of pegdroid">&laquo; first 18 days of pegdroid</a>
      
      
        <a class="basic-alignment right" href="/blog/2011/06/24/what-i-have-been-working-on/" title="Next Post: What I have been working on.. Android Kitchen Timer">What I have been working on.. Android Kitchen Timer &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p>Lead developer with electronic trading software by day, passionate about mobile. I spend a lot of my spare time writing software for android. Table Tennis player, snowboarder, dad. I also contribute to Firefox for Android.</p>
  <a href="mailto:fedepaol@gmail.com" target="_top">fedepaol@gmail.com</a>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/09/13/testing-rxjava-observables-subscriptions/">Unit Testing RxJava Observables and Subscriptions</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/05/mocking-with-robolectric-and-dagger-2/">Mocking With Robolectric and Dagger 2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/04/its-been-a-while/">It's Been a While</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/01/dragging-with-viewdraghelper/">Dragging With ViewDragHelper</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/24/migrating-from-blogger-to-octopress-done/">Migrating From Blogger to Octopress (Done!)</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/fedepaol">@fedepaol</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'fedepaol',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/+FedericoPaolinelli?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



<section>
	<h1>On Twitter:</h1>
	<div>
		<p><br /><a href="http://twitter.com/fedepaol" target="_blank">My Tweets, on Twitter.</a></p>
		<a href="http://twitter.com/fedepaol" class="twitter-follow-button" data-show-count="">Follow @fedepaol</a>
	</div>
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Federico Paolinelli -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
